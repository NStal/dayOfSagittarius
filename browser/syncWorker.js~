(function(exports){
    var Class = require("./util").Class
    var SyncWorker = Class.sub();
    //Client side worker
    SyncWorker.prototype._init = function(url,gateway){
	this.url = url;
	this.ws = null;
	this.gateway = gateway;
    }
    SyncWorker.prototype.start = function(){
	this.ws = new WebSocket(this.url);
	var self = this;
	this.ws.onopen = function(){
	    self.gateway.ready = true;
	    self.send({
		t:0
	    });
	}
	this.ws.onmessage = function(msg){
	    console.log(msg.data);
	    self.gateway.onmessage(JSON.parse(msg.data))
	}
	this.ws.onclose = function(){
	    alert("lost connection from server");
	    self.gateway.ready = false;
	    self.ws = null;
	}	
    }
    SyncWorker.prototype.send = function(msg){
	if(typeof msg!="string"){
	    msg = JSON.stringify(msg);
	}
	if(this.ws){
	    this.ws.send(msg);
	    return true;
	}else{
	    return false;
	}
    }
    exports.SyncWorker = SyncWorker;
})(exports)