(function(exports){
    var BattleField = require("./share/battleField").BattleField.sub()
    var Point = require("./util").Point;
    BattleField.prototype._init = function(info){
	BattleField.parent.prototype._init.call(this,info);
	this.position = new Point(0,0);
    }
    BattleField.prototype.act = function(msg){
	console.log(act);
    }
    BattleField.prototype.next = function(context){
	BattleField.parent.prototype.next.call(this);
	this.draw(context);
    }
    BattleField.prototype.draw = function(context){
	//recursive drawing
	context.save();
	if(typeof this.alpha != "undefined"){
	    context.globalAlpha = this.alpha;
	}
	if(this.position){
	    context.translate(this.position.x,this.position.y);
	}
	if(this.rotation){
	    context.rotate(this.rotation);
	}
	if(this.center){
	    context.translate(-this.center.x,-this.center.y); 
	}
	if(this.invert){
	    if(this.invertPadding){
		context.translate(this.invertPadding,0);
	    }
	    context.scale(-1,1);
	}
	if(typeof this.onDraw == "function"){
	    this.onDraw(context);
	}
	if(this.parts){
	    for(var i=0;i<this.parts.length;i++){
		BattleField.prototype.draw.call(this.parts[i],context);
	    }
	}
	if(typeof this.onClear == "function"){
	    this.onClear(context);
	}
	context.restore();
	return;
    }
    BattleField.prototype.onInstruction = function(instruction){
	var Protocol = require("./share/protocol");
	if(instruction.c==Protocol.clientCommand.sync){
	    this.initByShips(instruction.d.ships);
	    return;
	}
	BattleField.parent.prototype.onInstruction.call(this,instruction);
    }
    BattleField.prototype.initByShips = function(ships){
	console.log(ships.length);
	for(var i=0;i < ships.length;i++){
	    var ship = new Ship(ships[i]);
	    ship.onDraw = function(context){
		console.log(this.cordinates.toString());
	    }
	    this.add(ship);
	}
    }
    exports.BattleField = BattleField;
})(exports)
